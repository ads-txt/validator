version: "3.10"

volumes:
  app_validator:
  static_volume:

services:
    database:
        container_name: postgres_container
        image: postgres
        restart: on-failure
        environment:
            - POSTGRES_DB=${POSTGRES_DB}
            - POSTGRES_USER=${POSTGRES_USER}
            - POSTGRES_PASSWORD=${POSTGRES_PASSWORD}
            - DATABASE_URL=${DATABASE_URL}
        ports:
            - "5432:5432"
        volumes:
            - ./data/db:/var/lib/postgresql/data
    app:
        image: validator_container
        restart: always
        build:
            context: .
            dockerfile: compose/app/Dockerfile
        # depends_on:
        #     - database
        volumes:
            - app_validator:/app/ads_validator
            - static_volume:/app/static
        env_file:
            - ./compose.env
        expose:
            - "8000"
        ports:
            - "8000:8000"
            - "5433:5432"
    nginx:
        image: nginx_container
        build:
            context: compose/nginx
            dockerfile: Dockerfile
        restart: on-failure
        links:
            - app:app
        ports:
            - "8081:80"
        # depends_on:
        #     - app
        volumes:
            - static_volume:/app/static
    