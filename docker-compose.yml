version: "3.10"

volumes:
  app_validator:

services:
    app: &main-app
        image: ads-validator
        restart: always
        build:
            context: .
            dockerfile: compose/app/Dockerfile
        depends_on:
            - database
        volumes:
            - app_validator:/app/ads_validator
        env_file:
            - ./compose.env
    nginx:
        image: ads-validator-nginx
        build:
            context: compose/nginx
            dockerfile: Dockerfile
        restart: on-failure
        # volumes:
        #     - app_volume2:/app/volume2
        ports:
            - "8081:80"
        depends_on:
            - app
    database:
        container_name: postgres2
        image: postgres
        restart: on-failure
        environment:
            - POSTGRES_DB=${POSTGRES_DB}
            - POSTGRES_USER=${POSTGRES_USER}
            - POSTGRES_PASSWORD=${POSTGRES_PASSWORD}
            - DATABASE_URL=${DATABASE_URL}
        ports:
            - "${POSTGRES_PORT}:5432"
        volumes:
            - ./data/db:/var/lib/postgresql/data
